name: app-laravel-nginx

on:
  push:
    branches: [ "development","main"]


jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Cache Docker layers
      uses: actions/cache@v2
      with:
          path: /tmp/.buildx-cache
          key: ${{ runner.os }}-docker-${{ hashFiles('**/Dockerfile') }}
          restore-keys: |
            ${{ runner.os }}-docker-

    - name: Login to Docker Registry
      run:  echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag app-laravel:$(date +%s)
#    - name: Laravel command
#      run: |
#           chmod 0777 /var/www/html/conf/entrypoint.sh
#           ./var/www/html/conf/entrypoint.sh
#    - name: Tag Docker image
#      run:  docker image tag app-laravel:$(date +%s) ${{secrets.DOCKER_PATH_BASE}}/app-laravel:$(date +%s)
#    - name: Push Docker image
#      run: docker image push ${{secrets.DOCKER_PATH_BASE}}/app-laravel:$(date +%s)
